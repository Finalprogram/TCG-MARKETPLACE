<!DOCTYPE html>
<html lang="pt-br">
<head>
    <%- include('../partials/header') %>
    <title>Minha Lista - CardHub</title>
</head>
<body>
    <%- include('../partials/navbar') %>

    <main class="container">
        <h1>Minha Lista de Compras</h1>

        <% if (wantList && wantList.length > 0) { %>
            <!-- Adicionar mais cartas Ã  lista -->
            <button id="add-more-cards-btn" class="btn-secondary" style="margin-bottom: 1.5rem;">+ Adicionar mais cartas Ã  lista</button>

            <div class="want-list-container">
                <% wantList.forEach(item => { %>
                    <div class="want-list-item">
                        <div class="card-summary">
                            <img src="<%= item.card.image_url %>" alt="<%= item.card.name %>" class="summary-img">
                            <div class="summary-info">
                                <h3><%= item.card.name %></h3>
                                <p><%= item.card.set_name || 'N/A' %></p>
                                <span>Quantidade desejada: <strong><%= item.quantityWanted %></strong></span>
                            </div>
                            <div class="summary-price">
                                <span>A partir de</span>
                                <strong>R$ <%= item.lowestPrice ? item.lowestPrice.toFixed(2) : 'N/A' %></strong>
                            </div>
                            <button class="toggle-sellers-btn" data-target="sellers-<%= item.card._id %>">
                                Ver Vendedores <span>â–¼</span>
                            </button>
                            <button class="remove-from-list-btn" data-cardid="<%= item.card._id %>" title="Remover da lista">&times;</button>
                        </div>

                        <!-- Painel de vendedores -->
                        <div class="sellers-drawer" id="sellers-<%= item.card._id %>">
                            <div class="seller-filters">
                                <select class="item-filter-select form-control" data-filter="condition">
                                    <option value="N">Novo</option>
                                    <option value="NM">Praticamente Nova</option>
                                    <option value="NM">Near Mint</option>
                                    <option value="LP">Lightly Played</option>
                                    <option value="MP">Moderadamente Usada</option>
                                    
                                </select>
                                <select class="item-filter-select form-control" data-filter="language">
                                    <option value="pt">PortuguÃªs</option>
                                    <option value="en">InglÃªs</option>
                                </select>
                                <select class="item-filter-select form-control" data-filter="is_foil">
                                    <option value="">Todos</option>
                                    <option value="false">Normal</option>
                                    <option value="true">Foil</option>
                                </select>
                            </div>

                            <div class="listings-container">
                                <% if (item.listings.length > 0) { %>
                                    <% item.listings.forEach(listing => { %>
                                        <div class="listing-row">
                                            <div class="seller-info">
                                                <strong><%= listing.seller.username %></strong>
                                                <% if (listing.seller.accountType === 'shop') { %>
                                                    <span class="shop-badge">LOJA</span>
                                                <% } %>
                                            </div>
                                            <div class="condition-info">
                                                <span><%= listing.condition %></span> |
                                                <span><%= listing.is_foil ? 'Foil' : 'Normal' %></span>
                                            </div>
                                            <div class="price-info">
                                                <strong>R$ <%= listing.price.toFixed(2) %></strong>
                                            </div>
                                            <div class="add-to-cart-controls">
                                                <input type="number" class="quantity-input form-control" value="1" min="1" max="<%= listing.quantity %>">
                                                <button class="btn-primary add-final-cart-btn" data-listingid="<%= listing._id %>">+ Carrinho</button>
                                            </div>
                                        </div>
                                    <% }) %>
                                <% } else { %>
                                    <p class="no-listings">Nenhum anÃºncio encontrado para esta carta.</p>
                                <% } %>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <div class="empty-list-message" style="text-align: center; padding: 4rem 0;">
                <h2>Sua lista estÃ¡ vazia.</h2>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">Navegue pelas cartas e clique em "+ Lista" para adicionÃ¡-las aqui.</p>
                <a href="/cards/magic" class="btn-primary">Explorar Cartas</a>
            </div>
        <% } %>
<button id="floating-cart-button">
    <span class="list-icon">ðŸ›’</span> <span class="list-item-count hidden">0</span>
</button>
    </main>

    <div id="add-card-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <h2>Adicionar Carta Ã  Lista</h2>
            <div class="form-group">
                <input type="search" id="modal-search-input" class="form-control" placeholder="Digite o nome da carta...">
            </div>
            <div id="modal-search-results"></div>
        </div>
    </div>

    <%- include('../partials/footer') %>
    <script src="/js/main.js"></script>
    <script>  document.getElementById('floating-list-button')?.setAttribute('data-action', 'open-cart-modal');</script>
</body>
</html>
